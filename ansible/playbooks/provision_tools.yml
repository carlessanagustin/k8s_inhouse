---
- hosts:
    - masters
  tasks:
    - name: "install k8s tools - kompose, kustomize & sysdig"
      tags:
        - kompose
        - kustomize
        - sysdig
      shell: "{{ item}}"
      loop:
        - "sudo curl -L https://github.com/kubernetes/kompose/releases/download/v1.16.0/kompose-linux-amd64 -o /usr/local/bin/kompose"
        - "sudo chmod +x /usr/local/bin/kompose"
        - "sudo curl -L https://github.com/kubernetes-sigs/kustomize/releases/download/v1.0.8/kustomize_1.0.8_linux_amd64 -o /usr/local/bin/kustomize"
        - "sudo chmod +x /usr/local/bin/kustomize"
        - "curl -s https://s3.amazonaws.com/download.draios.com/stable/install-sysdig | sudo bash"


    - name: create ark installation path
      tags:
        - ark
      file:
        path: ark
        state: directory
        mode: 0775

    - name: install ark tool
      tags:
        - ark
      shell: "{{ item}}"
      args:
        chdir: ark
      loop:
        - "mkdir -p ./ark && cd ./ark"
        - "wget https://github.com/heptio/ark/releases/download/v0.10.0/ark-v0.10.0-linux-amd64.tar.gz"
        - "tar zxvf ark-v0.10.0-linux-amd64.tar.gz "
        - "sudo cp ark /usr/local/bin"
        - "sudo chown root:root /usr/local/bin/*"
